services:
  # 后端 API 服务
  - type: web
    name: z-image-api
    env: python
    repo: https://github.com/xianyu110/z-image.git
    rootDir: .
    plan: free
    buildCommand: |
      pip install -r requirements.txt
    startCommand: |
      python zimage_proxy_simple.py
    envVars:
      - key: PORT
        value: 8000
      - key: PYTHONUNBUFFERED
        value: "true"
      - key: ZIMAGE_API_HOST
        value: https://zimage.run
      - key: ENABLE_KEEP_ALIVE
        value: "true"
    healthCheckPath: /health
    autoDeploy: true

  # 前端静态文件服务
  - type: web
    name: z-image-frontend
    env: static
    repo: https://github.com/xianyu110/z-image.git
    rootDir: web
    buildCommand: ""
    staticPublishPath: .
    plan: free
    routes:
      - type: rewrite
        source: /api/*
        destination: https://z-image-api.onrender.com
    autoDeploy: true

  # Keep-alive Cron 服务（使用独立的ping脚本）
  - type: cron
    name: z-image-keepalive
    repo: https://github.com/xianyu110/z-image.git
    schedule: "*/15 * * * *"  # 每15分钟运行一次（比休眠时间短一点）
    buildCommand: |
      pip install requests
    startCommand: |
      python3 cron_ping.py
    envVars:
      - key: RENDER_URL
        value: https://z-image-api.onrender.com